<div
  class="relative z-10 w-full max-w-md rounded-2xl shadow-md p-6 bg-primary-100 border border-primary-300
         hover:shadow-lg transition-shadow duration-200 flex flex-col gap-4 cursor-pointer"
  (click)="navigateToDetails()"
>
  <div class="flex items-center justify-between">
    <h2 class="text-2xl font-semibold text-text-800">
      {{ certificate.commonName }}
    </h2>

    <span
      class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium text-white"
      [ngClass]="{
        'bg-green-600': certificate.status.toString() === 'Active',
        'bg-red-600': certificate.status.toString() === 'Expired',
        'bg-yellow-600': certificate.status.toString() === 'Revoked'
      }"
    >
      <ng-container [ngSwitch]="certificate.status.toString()">
        <lucide-icon *ngSwitchCase="'Active'" name="check-circle" class="w-4 h-4"></lucide-icon>
        <lucide-icon *ngSwitchCase="'Expired'" name="x-circle" class="w-4 h-4"></lucide-icon>
        <lucide-icon *ngSwitchCase="'Revoked'" name="alert-circle" class="w-4 h-4"></lucide-icon>
      </ng-container>
      {{ certificate.status }}
    </span>
  </div>

  <div class="flex items-center">
    <lucide-icon name="mail" class="w-5 h-5 mr-3 text-secondary-500"></lucide-icon>
    <span class="text-text-800 font-medium break-all">{{ certificate.email }}</span>
  </div>

  <div class="flex gap-6">
    <div class="flex items-center">
      <lucide-icon name="calendar" class="w-5 h-5 mr-2 text-secondary-500"></lucide-icon>
      <div>
        <span class="text-sm text-text-600">Valid From</span>
        <div class="text-text-800 font-medium">
          {{ certificate.validFrom | date: 'mediumDate' }}
        </div>
      </div>
    </div>
    <div class="flex items-center">
      <lucide-icon name="calendar" class="w-5 h-5 mr-2 text-secondary-500"></lucide-icon>
      <div>
        <span class="text-sm text-text-600">Valid To</span>
        <div class="text-text-800 font-medium">
          {{ certificate.validTo | date: 'mediumDate' }}
        </div>
      </div>
    </div>
  </div>

  <!-- Revoke button inside card but does not trigger navigation -->
  <button
    *ngIf="enableRevoking"
    (click)="openRevokeModal($event)"
    class="mt-4 px-4 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700"
  >
    Revoke
  </button>
</div>

<!-- Modal -->
<div
  *ngIf="showRevokeModal"
  class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
>
  <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6">
    <h3 class="text-lg font-semibold mb-4">Revoke Certificate</h3>

    <label for="reason" class="block text-sm font-medium text-gray-700 mb-2">
      Select reason
    </label>
    <select
      id="reason"
      [(ngModel)]="selectedReason"
      class="w-full border border-gray-300 rounded-lg px-3 py-2 mb-4"
    >
      <option [ngValue]="null" disabled>Select a reason</option>
      <option *ngFor="let reason of reasons" [ngValue]="reason">
        {{ reason }}
      </option>
    </select>

    <div class="flex justify-end gap-3">
      <button
        (click)="closeRevokeModal()"
        class="px-4 py-2 rounded-lg bg-gray-300 hover:bg-gray-400"
      >
        Cancel
      </button>
      <button
        (click)="confirmRevoke()"
        [disabled]="!selectedReason"
        class="px-4 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 disabled:opacity-50"
      >
        Confirm Revoke
      </button>
    </div>
  </div>
</div>
